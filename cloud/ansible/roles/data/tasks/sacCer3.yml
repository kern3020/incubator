---
# download and prepare sacCer3 reference data.

- name: make data dir
  file:
    path: "{{ data_dir }}"
    state: directory
    owner: jkern
    group: jkern

- stat:
    path="{{ data_dir }}/chromFa.tar.gz"
  register: yeast_tar

- name: download reference genome for yeast
  get_url:
    url: ftp://hgdownload.cse.ucsc.edu/goldenPath/sacCer3/bigZips/chromFa.tar.gz
    dest: "{{ data_dir }}"
  when: yeast_tar.stat.exists == False

- name: extract the genome
  shell: tar -zxf chromFa.tar.gz
  args:
    chdir: "{{ data_dir }}"    

- stat:
    path="{{ data_dir }}/wg.fa"
  register: wg
    
- name: concatenate chromosome files into a whole genome
  shell: cat *.fa > wg.fa
  args:
    chdir: "{{ data_dir }}"
  when: wg.stat.exists == False

- name: make data dir
  file:
    path: "{{ tools_dir }}"
    state: directory
    owner: jkern
    group: jkern

- stat:
    path="{{ tools_dir }}/sratoolkit.2.4.3-ubuntu64.tar.gz"
  register: sra

- name: download ncbi SRA toolkit
  get_url:
    url: http://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/2.4.3/sratoolkit.2.4.3-ubuntu64.tar.gz
    dest: "{{ tools_dir }}"
  when: sra.stat.exists == False

- stat:
    path="{{ tools_dir }}/sratoolkit.2.4.3-ubuntu64"
  register: tools
  
- name: extract the genome
  shell: tar -zxf sratoolkit.2.4.3-ubuntu64.tar.gz
  args:
    chdir: "{{ tools_dir }}"
  when: tools.stat.exists == False

- stat:
    path="{{ data_dir }}/ERR302903_1.fastq"
  register: sra_data
  
- name: download sample
  shell: "~/tools/sratoolkit.2.4.3-ubuntu64/bin/fastq-dump  --split-files ERR302903"
  args:
    chdir: "{{ data_dir }}"
  when: sra_data.stat.exists == False
