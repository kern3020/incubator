---
- name: get SPAdes sorce
  hosts: all
  vars:
    spades_name: SPAdes-3.5.0
    spades_dir:  /mnt/data/SPAdes
    mount_pt: /mnt/data
  sudo: true
  tasks:
    - name: create dir for moint point 
      file:
        dest: "{{ mount_pt }}"
        state: directory
        owner: jkern
        group: jkern

    - name:  format disk if needed (gce specific)
      shell: /usr/share/google/safe_format_and_mount -m "mkfs.ext4 -F" /dev/sdb "{{ mount_pt }}"

    - name: download SPAdes source code
      get_url: 
        url: http://spades.bioinf.spbau.ru/release3.5.0/{{ spades_name }}.tar.gz
        dest: /tmp

    - name: extract SPAdes 
      unarchive:   
        src: /tmp/{{ spades_name }}.tar.gz
        dest: /tmp
        owner: jkern
        group: jkern
        copy: no

    - name: compiling SPAdes 
      shell: PREFIX="{{ spades_dir }}/{{ spades_name }}" ./spades_compile.sh
      args:
        chdir: /tmp/{{ spades_name }}

